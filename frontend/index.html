<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bill Splitter - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å—á–µ—Ç–æ–≤</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è UX */
        .quality-tips {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .quality-tips h4 {
            margin-top: 0;
            color: #1976D2;
        }
        
        .quality-tips ul {
            margin-bottom: 0;
            padding-left: 20px;
        }
        
        .debug-panel {
            background: #f5f5f5;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
            font-size: 12px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .receipt-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .receipt-type-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .receipt-type-btn.active {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .enhance-options {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .enhance-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            cursor: pointer;
            font-size: 14px;
        }
        
        .enhance-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üí∏ Bill Splitter</h1>
            <p>–ü—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± —Ä–∞–∑–¥–µ–ª–∏—Ç—å —Å—á–µ—Ç–∞ —Å –¥—Ä—É–∑—å—è–º–∏</p>
        </header>

        <nav class="tabs">
            <button class="tab-button active" data-tab="create">–°–æ–∑–¥–∞—Ç—å —Å—á–µ—Ç</button>
            <button class="tab-button" data-tab="bills">–ú–æ–∏ —Å—á–µ—Ç–∞</button>
            <button class="tab-button" data-tab="split">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
        </nav>

        <main>
            <!-- –í–∫–ª–∞–¥–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—á–µ—Ç–∞ -->
            <div id="create-tab" class="tab-content active">
                <div class="card">
                    <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å—á–µ—Ç</h2>
                    
                    <form id="bill-form">
                        <div class="form-group">
                            <label for="bill-title">–ù–∞–∑–≤–∞–Ω–∏–µ —Å—á–µ—Ç–∞:</label>
                            <input type="text" id="bill-title" required placeholder="–£–∂–∏–Ω –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ">
                        </div>

                        <div class="form-group">
                            <label for="bill-description">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                            <textarea id="bill-description" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"></textarea>
                        </div>

                        <div class="form-row">
                            <!-- –£–ë–†–ê–ù–û –ü–û–õ–ï –ù–ê–õ–û–ì–ê -->
                            <div class="form-group">
                                <label for="bill-tip">–ß–∞–µ–≤—ã–µ (%):</label>
                                <input type="number" id="bill-tip" value="10" min="0" step="0.1">
                            </div>
                            <div class="form-group">
                                <label for="bill-currency">–í–∞–ª—é—Ç–∞:</label>
                                <select id="bill-currency">
                                    <option value="RUB">‚ÇΩ RUB</option>
                                    <option value="USD">$ USD</option>
                                    <option value="EUR">‚Ç¨ EUR</option>
                                    <option value="GBP">¬£ GBP</option>
                                </select>
                            </div>
                        </div>

                        <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ -->
                        <div class="form-section">
                            <h3>–£—á–∞—Å—Ç–Ω–∏–∫–∏</h3>
                            <div id="participants-container">
                                <div class="participant">
                                    <input type="text" class="participant-name" placeholder="–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞" required>
                                    <input type="email" class="participant-email" placeholder="Email (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)">
                                    <button type="button" class="remove-participant" onclick="removeParticipant(this)">√ó</button>
                                </div>
                            </div>
                            <button type="button" class="btn-secondary" onclick="addParticipant()">+ –î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</button>
                        </div>

                        <!-- –ü–æ–∑–∏—Ü–∏–∏ —Å—á–µ—Ç–∞ -->
                        <div class="form-section">
                            <h3>–ü–æ–∑–∏—Ü–∏–∏ —Å—á–µ—Ç–∞</h3>
                            <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                                <button type="button" class="btn-secondary" onclick="addItem()">+ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é</button>
                                <button type="button" class="btn-secondary" onclick="app.openScanModal()">
                                    üì∑ –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —á–µ–∫
                                </button>
                                <button type="button" class="btn-secondary" onclick="app.openManualReceiptModal()">
                                    üìù –í–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç —á–µ–∫–∞
                                </button>
                            </div>
                            <div id="items-container">
                                <div class="item">
                                    <input type="text" class="item-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏" required>
                                    <input type="number" class="item-price" placeholder="–¶–µ–Ω–∞" min="0" step="0.01" required>
                                    <div class="item-consumers">
                                        <label class="consumer-checkbox">
                                            <input type="checkbox" value="0" checked> –£—á–∞—Å—Ç–Ω–∏–∫ 1
                                        </label>
                                    </div>
                                    <button type="button" class="remove-item" onclick="removeItem(this)">√ó</button>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn-primary">–°–æ–∑–¥–∞—Ç—å —Å—á–µ—Ç</button>
                    </form>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ —Å–ø–∏—Å–∫–∞ —Å—á–µ—Ç–æ–≤ -->
            <div id="bills-tab" class="tab-content">
                <div class="card">
                    <h2>–ú–æ–∏ —Å—á–µ—Ç–∞</h2>
                    <div id="bills-list" class="bills-grid">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—á–µ—Ç–æ–≤...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
            <div id="split-tab" class="tab-content">
                <div class="card">
                    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è</h2>
                    <div id="split-results">
                        <p class="placeholder">–í—ã–±–µ—Ä–∏—Ç–µ —Å—á–µ—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—á–µ—Ç–∞ -->
    <div id="bill-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ–∫–∞ -->
    <div id="scan-receipt-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="app.closeScanModal()">&times;</span>
            <h2>üì∑ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ–∫–∞</h2>
            
            <div class="quality-tips">
                <h4>–°–æ–≤–µ—Ç—ã –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è:</h4>
                <ul>
                    <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ö–æ—Ä–æ—à–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ</li>
                    <li>–°—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä—É–π—Ç–µ —á–µ–∫ –ø—Ä—è–º–æ, –±–µ–∑ –Ω–∞–∫–ª–æ–Ω–∞</li>
                    <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–µ—Å—å —Ç–µ–∫—Å—Ç —á–µ–∫–∞ –≤–∏–¥–µ–Ω</li>
                    <li>–ò–∑–±–µ–≥–∞–π—Ç–µ –±–ª–∏–∫–æ–≤ –∏ —Ç–µ–Ω–µ–π</li>
                </ul>
            </div>
            
            <div class="scan-steps">
                <div class="step active" data-step="1">–ó–∞–≥—Ä—É–∑–∫–∞</div>
                <div class="step" data-step="2">–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ</div>
                <div class="step" data-step="3">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
            </div>

            <!-- –®–∞–≥ 1: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ -->
            <div id="scan-step-1" class="scan-step active">
                <div class="receipt-type-selector">
                    <div class="receipt-type-btn active" data-type="restaurant">
                        üçΩÔ∏è –†–µ—Å—Ç–æ—Ä–∞–Ω/–ö–∞—Ñ–µ
                    </div>
                    <div class="receipt-type-btn" data-type="store">
                        üõí –ú–∞–≥–∞–∑–∏–Ω
                    </div>
                    <div class="receipt-type-btn" data-type="other">
                        üìÑ –î—Ä—É–≥–æ–µ
                    </div>
                </div>
                
                <div class="upload-area" id="upload-area">
                    <div class="upload-placeholder">
                        <span class="upload-icon">üìÅ</span>
                        <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ —Ñ–æ—Ç–æ —á–µ–∫–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                        <p class="upload-hint">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: JPG, PNG</p>
                    </div>
                    <input type="file" id="receipt-file" accept="image/*" style="display: none;">
                </div>
                
                <div class="enhance-options">
                    <button type="button" class="enhance-btn active" data-enhance="auto">–ê–≤—Ç–æ</button>
                    <button type="button" class="enhance-btn" data-enhance="contrast">–ö–æ–Ω—Ç—Ä–∞—Å—Ç</button>
                    <button type="button" class="enhance-btn" data-enhance="grayscale">–ß–µ—Ä–Ω–æ-–±–µ–ª—ã–π</button>
                </div>
                
                <button type="button" class="btn-secondary" onclick="document.getElementById('receipt-file').click()">
                    –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
                </button>
                
                <div style="text-align: center; margin-top: 15px;">
                    <button type="button" class="btn-secondary" onclick="app.openManualReceiptModal()">
                        –ò–ª–∏ –≤–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é
                    </button>
                </div>
            </div>

            <!-- –®–∞–≥ 2: –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ -->
            <div id="scan-step-2" class="scan-step">
                <div class="preview-container">
                    <div class="image-preview">
                        <img id="receipt-preview" src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —á–µ–∫–∞">
                        <div class="progress-overlay" id="progress-overlay" style="display: none;">
                            <div class="spinner"></div>
                            <p id="progress-text">–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ...</p>
                        </div>
                    </div>
                    <div class="text-preview">
                        <h4>–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:</h4>
                        <textarea id="recognized-text" placeholder="–¢–µ–∫—Å—Ç –±—É–¥–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏..." readonly></textarea>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button type="button" class="btn-secondary" onclick="app.manualEditText()">
                                –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <button type="button" class="btn-secondary" onclick="app.retryRecognition()">
                                –ü–æ–≤—Ç–æ—Ä–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
                <div class="scan-actions">
                    <button type="button" class="btn-secondary" onclick="app.previousStep()">–ù–∞–∑–∞–¥</button>
                    <button type="button" class="btn-primary" onclick="app.parseReceiptText()" id="parse-btn">
                        üìä –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏
                    </button>
                </div>
            </div>

            <!-- –®–∞–≥ 3: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è -->
            <div id="scan-step-3" class="scan-step">
                <div class="scan-results">
                    <h4>–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏:</h4>
                    <div id="parsed-items-list" class="parsed-items">
                        <!-- –ü–æ–∑–∏—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–¥–µ—Å—å -->
                    </div>
                    <div class="scan-summary">
                        <p>–ù–∞–π–¥–µ–Ω–æ –ø–æ–∑–∏—Ü–∏–π: <span id="items-count">0</span></p>
                        <p>–û–±—â–∞—è —Å—É–º–º–∞: <span id="total-amount">0</span> <span id="currency-symbol">‚ÇΩ</span></p>
                    </div>
                </div>
                <div class="scan-actions">
                    <button type="button" class="btn-secondary" onclick="app.previousStep()">–ù–∞–∑–∞–¥</button>
                    <button type="button" class="btn-primary" onclick="app.addParsedItemsToBill()">
                        ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∫ —Å—á–µ—Ç—É
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ —á–µ–∫–∞ -->
    <div id="manual-receipt-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="app.closeManualReceiptModal()">&times;</span>
            <h2>üìù –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ —á–µ–∫–∞</h2>
            
            <div class="quality-tips">
                <h4>–§–æ—Ä–º–∞—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è:</h4>
                <ul>
                    <li>–ö–∞–∂–¥–∞—è –ø–æ–∑–∏—Ü–∏—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ</li>
                    <li>–¶–µ–Ω–∞ –≤ –∫–æ–Ω—Ü–µ —Å—Ç—Ä–æ–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ö–æ—Ñ–µ 250.00")</li>
                    <li>–ò–∑–±–µ–≥–∞–π—Ç–µ –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ –∏ —Å–ª—É–∂–µ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</li>
                </ul>
            </div>
            
            <div class="form-group">
                <label for="manual-receipt-text">–¢–µ–∫—Å—Ç —á–µ–∫–∞:</label>
                <textarea id="manual-receipt-text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —á–µ–∫–∞ –∑–¥–µ—Å—å...
–ù–∞–ø—Ä–∏–º–µ—Ä:
–ö–æ—Ñ–µ 250.00
–°–∞–ª–∞—Ç –¶–µ–∑–∞—Ä—å 450.00
–°—Ç–µ–π–∫ 1200.00" style="height: 300px; font-family: monospace;"></textarea>
            </div>
            
            <div class="form-group">
                <label for="manual-currency">–í–∞–ª—é—Ç–∞:</label>
                <select id="manual-currency">
                    <option value="RUB">‚ÇΩ RUB</option>
                    <option value="USD">$ USD</option>
                    <option value="EUR">‚Ç¨ EUR</option>
                    <option value="GBP">¬£ GBP</option>
                </select>
            </div>
            
            <div class="scan-actions">
                <button type="button" class="btn-secondary" onclick="app.closeManualReceiptModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn-primary" onclick="app.processManualReceipt()">
                    üìä –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏
                </button>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∏–º Tesseract.js –¥–ª—è OCR -->
    <script src="https://unpkg.com/tesseract.js@v4.1.1/dist/tesseract.min.js"></script>
    <script src="app.js"></script>
    <script>
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        document.addEventListener('DOMContentLoaded', function() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ —á–µ–∫–∞
            document.querySelectorAll('.receipt-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.receipt-type-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    app.currentReceiptType = this.dataset.type;
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —É–ª—É—á—à–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            document.querySelectorAll('.enhance-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.enhance-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    app.currentEnhanceMode = this.dataset.enhance;
                });
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            app.currentReceiptType = 'restaurant';
            app.currentEnhanceMode = 'auto';
        });
    </script>
</body>
</html>